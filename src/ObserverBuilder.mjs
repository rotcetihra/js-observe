import Observer from './Observer.mjs';
import ObserverOptionsBuilder from './ObserverOptionsBuilder.mjs';

/**
 * üß± `ObserverBuilder` ‚Äî —Å—Ç—Ä–æ–∏—Ç–µ–ª—å (builder) –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ {@link Observer}.
 *
 * –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–≥–ª—è–¥–Ω–æ –∏ –ø–æ—à–∞–≥–æ–≤–æ –∑–∞–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è –∑–∞ DOM: —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏ callback.
 * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—É—é –∏ –±–µ–∑–æ–ø–∞—Å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π {@link ObserverOptionsBuilder}.
 *
 * ---
 *
 * ### üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
 *
 * - üì¶ –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –ª–æ–≥–∏–∫–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
 * - üí¨ Fluent-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: —Ü–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏.
 * - üîß –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö —Å–ø–æ—Å–æ–±–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
 *   - `.with(options)` ‚Äî –µ—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–∂–µ –∏–∑–≤–µ—Å—Ç–Ω—ã
 *   - `.options(builder => builder.‚Ä¶)` ‚Äî –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è —Å–±–æ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ {@link ObserverOptionsBuilder}
 * - üõ°Ô∏è –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ callback –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º.
 *
 * ---
 *
 * ### üõ†Ô∏è –ú–µ—Ç–æ–¥—ã:
 *
 * - `for(target)` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å DOM-—É–∑–µ–ª, –∑–∞ –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–æ –Ω–∞–±–ª—é–¥–∞—Ç—å.
 * - `with(options)` ‚Äî –Ω–∞–ø—Ä—è–º—É—é –ø–µ—Ä–µ–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç –æ–ø—Ü–∏–π ({@link MutationObserverInit} / {@link ObserverOptions}).
 * - `options(configureFn)` ‚Äî –ø–µ—Ä–µ–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É—é—â—É—é {@link ObserverOptionsBuilder}.
 * - `call(callback)` ‚Äî –∑–∞–¥–∞—Ç—å callback-—Ñ—É–Ω–∫—Ü–∏—é, –≤—ã–∑—ã–≤–∞–µ–º—É—é –ø—Ä–∏ –º—É—Ç–∞—Ü–∏—è—Ö.
 * - `build()` ‚Äî —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä {@link Observer} —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
 *
 * ---
 *
 * ### ‚úÖ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
 *
 * ```js
 *
 * import ObserverBuilder from './ObserverBuilder.mjs';
 *
 * const observer = new ObserverBuilder()
 *     .for(document.getElementById('content'))
 *     .options((b) => b.descendants().attributes(['data-state']).text().useOldValue())
 *     .call((mutations) => {
 *         for (const mutation of mutations) {
 *             console.log(mutation);
 *         }
 *     })
 *     .build();
 *
 * observer.observe();
 *
 * ```
 *
 * ---
 *
 * ### ‚ö†Ô∏è –í–∞–∂–Ω–æ:
 *
 * –ú–µ—Ç–æ–¥ `call()` —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º ‚Äî –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è callback –≤—ã–∑–æ–≤ `.build()` –≤—ã–±—Ä–æ—Å–∏—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.
 *
 * ---
 *
 * @class ObserverBuilder
 */
class ObserverBuilder {
    /**
     * üß© Callback-—Ñ—É–Ω–∫—Ü–∏—è, –≤—ã–∑—ã–≤–∞–µ–º–∞—è –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ {@link Observer}.
     *
     * –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é —á–∞—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è.
     * –ó–∞–¥–∞—ë—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `.call(callback)` –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `Observer` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `.build()`.
     *
     * ---
     *
     * ### üìê –°–∏–≥–Ω–∞—Ç—É—Ä–∞:
     *
     * ```ts
     *
     * (mutations: MutationRecord[], observer: MutationObserver) => void
     *
     * ```
     *
     * ---
     *
     * ### ‚úÖ –ü—Ä–∏–º–µ—Ä:
     *
     * ```js
     *
     * builder.call((mutations, observer) => {
     *     mutations.forEach(m => console.log(m));
     * });
     *
     * ```
     *
     * ---
     *
     * @type {MutationCallback}
     * @private
     */
    #callback;

    /**
     * ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è ({@link ObserverOptions}), –ø—Ä–∏–º–µ–Ω—è–µ–º–∞—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `observe()`.
     *
     * –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:
     *
     * - —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `.with(options)`, –≥–¥–µ `options` ‚Äî —ç—Ç–æ –≤—Ä—É—á–Ω—É—é —Å–æ–±—Ä–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç
     * - –∏–ª–∏ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `.options(builderCallback)`, –∏—Å–ø–æ–ª—å–∑—É—è {@link ObserverOptionsBuilder} –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–π —Å–±–æ—Ä–∫–∏
     *
     * ---
     *
     * ### üîç –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å `.with()`:
     *
     * ```js
     *
     * builder.with({ childList: true, subtree: true });
     *
     * ```
     *
     * ### üîç –ü—Ä–∏–º–µ—Ä —Å `.options()` –∏ builder-–æ–º:
     *
     * ```js
     *
     * builder.options((b) => b.descendants().attributes(['class']).useOldValue());
     *
     * ```
     *
     * ---
     *
     * –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —á–µ—Ä–µ–∑ `.build()` –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω `undefined`,
     * —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞—Ç—å –æ–ø—Ü–∏–∏ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ –º–µ—Ç–æ–¥ `observe`).
     *
     * ---
     *
     * @type {MutationObserverInit | undefined}
     * @private
     */
    #options;

    /**
     * üéØ –¶–µ–ª–µ–≤–æ–π DOM-—ç–ª–µ–º–µ–Ω—Ç, –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç –≤–µ—Å—Ç–∏—Å—å –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ.
     *
     * –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `.for(target)`, –≥–¥–µ `target` ‚Äî —ç—Ç–æ –ª—é–±–æ–π `Node`,
     * –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π {@link MutationObserver}, –Ω–∞–ø—Ä–∏–º–µ—Ä: `Element`, `Document`, `DocumentFragment`.
     *
     * ---
     *
     * ### ‚úÖ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
     *
     * ```js
     *
     * builder.for(document.querySelector('#app'));
     *
     * ```
     *
     * ---
     *
     * –ï—Å–ª–∏ —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª –Ω–µ –∑–∞–¥–∞–Ω, –µ–≥–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `observer.observe(target)`.
     * –û–¥–Ω–∞–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `.build()`, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å target.
     *
     * ---
     *
     * ### üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
     * - –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –¥–æ `.build()`.
     * - –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–¥–æ–±–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –∏ —Ç—É –∂–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É–∑–ª–æ–≤ (—Å–æ–∑–¥–∞–≤–∞—è –Ω–µ—Å–∫–æ–ª—å–∫–æ Observer-–æ–≤).
     * - –ï—Å–ª–∏ –≤—ã–∑–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ ‚Äî –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π target.
     *
     * ---
     *
     * @type {Node | undefined}
     * @private
     */
    #target;

    /**
     * üéØ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **—Ü–µ–ª–µ–≤–æ–π DOM-—É–∑–µ–ª** –¥–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.
     *
     * –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –∑–∞–¥–∞—ë—Ç `target` ‚Äî —É–∑–µ–ª, –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥–µ—Ç —Å–ª–µ–¥–∏—Ç—å {@link Observer}.
     * –û–±—ã—á–Ω–æ —ç—Ç–æ —ç–ª–µ–º–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`HTMLElement`), –Ω–æ —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `Document` –∏–ª–∏ `DocumentFragment`.
     *
     * ---
     *
     * ### ‚úÖ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
     *
     * ```js
     *
     * const builder = new ObserverBuilder()
     *     .for(document.getElementById('content'));
     *
     * ```
     *
     * ---
     *
     * –ï—Å–ª–∏ —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª –Ω–µ –∑–∞–¥–∞–Ω, –µ–≥–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `observer.observe(target)`.
     * –û–¥–Ω–∞–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `.build()`, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å target.
     *
     * ---
     *
     * ### üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
     *
     * - –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –¥–æ `.build()`.
     * - –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–¥–æ–±–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –∏ —Ç—É –∂–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É–∑–ª–æ–≤ (—Å–æ–∑–¥–∞–≤–∞—è –Ω–µ—Å–∫–æ–ª—å–∫–æ Observer-–æ–≤).
     * - –ï—Å–ª–∏ –≤—ã–∑–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ ‚Äî –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π target.
     *
     * ---
     *
     * @param {Node} target - DOM-—É–∑–µ–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, HTMLElement, Document, DocumentFragment), –∑–∞ –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–æ –Ω–∞–±–ª—é–¥–∞—Ç—å.
     * @returns {ObserverBuilder} this ‚Äî –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ü–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–æ–≤.
     */
    for(target) {
        this.#target = target;

        return this;
    }

    /**
     * ‚öôÔ∏è –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **–æ–±—ä–µ–∫—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** ({@link ObserverOptions}) –¥–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.
     *
     * –ü–æ–∑–≤–æ–ª—è–µ—Ç —è–≤–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –æ–ø—Ü–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–±—Ä–∞–Ω–Ω—ã–π –≤—Ä—É—á–Ω—É—é
     * –∏–ª–∏ —Å –ø–æ–º–æ—â—å—é {@link ObserverOptionsBuilder}, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å, –∫–∞–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è DOM –Ω—É–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
     * –∞—Ç—Ä–∏–±—É—Ç—ã, —Ç–µ–∫—Å—Ç, –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã –∏ —Ç.–¥.
     *
     * ---
     *
     * ### ‚úÖ –ü—Ä–∏–º–µ—Ä:
     *
     * ```js
     *
     * const options = new ObserverOptionsBuilder()
     *     .descendants()
     *     .attributes(['data-state'])
     *     .useOldValue()
     *     .build();
     *
     * const builder = new ObserverBuilder()
     *     .with(options);
     *
     * ```
     *
     * ---
     *
     * ### üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
     *
     * - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Å –æ–±—ã—á–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º MutationObserverInit, —Ç–∞–∫ –∏ —Å —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º ObserverOptions.
     * - –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –º–µ—Ç–æ–¥ `.options(cb)`, —Ç–æ `.with()` –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.
     * - –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–∑–æ–≤ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
     * - –ï—Å–ª–∏ –Ω–µ –≤—ã–∑–≤–∞—Ç—å –Ω–∏ `.with()`, –Ω–∏ `.options()`, —Ç–æ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `.build()` –æ–ø—Ü–∏–∏ –±—É–¥—É—Ç –Ω–µ –∑–∞–¥–∞–Ω—ã (undefined).
     *
     * ---
     *
     * @param {MutationObserverInit} options - –û–±—ä–µ–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ ObserverOptionsBuilder –∏–ª–∏ –≤—Ä—É—á–Ω—É—é).
     * @returns {ObserverBuilder} this ‚Äî –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ü–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–æ–≤.
     */
    with(options) {
        this.#options = options;

        return this;
    }

    /**
     * üß± –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± **—Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è** —á–µ—Ä–µ–∑ –±–∏–ª–¥–µ—Ä {@link ObserverOptionsBuilder}.
     *
     * –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ –∏ –Ω–∞–≥–ª—è–¥–Ω–æ —Å–æ–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–±–ª—é–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ fluent-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–∏–ª–¥–µ—Ä–∞,
     * –∏–∑–±–µ–≥–∞—è —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ –æ–ø—Ü–∏–π. –í–Ω—É—Ç—Ä–∏ callback-—Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã –≤—ã–∑—ã–≤–∞–µ—Ç–µ –º–µ—Ç–æ–¥—ã –±–∏–ª–¥–µ—Ä–∞,
     * –æ–ø—Ä–µ–¥–µ–ª—è—è –Ω—É–∂–Ω—ã–µ —Ç–∏–ø—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π (children, attributes, text –∏ —Ç.–¥.).
     *
     * ---
     *
     * ### ‚úÖ –ü—Ä–∏–º–µ—Ä:
     *
     * ```js
     *
     * const observer = new ObserverBuilder()
     *     .for(document.body)
     *     .options((o) => o
     *         .descendants()
     *         .attributes(['class'])
     *         .text()
     *         .useOldValue()
     *     )
     *     .call(callback)
     *     .build();
     *
     * observer.observe();
     *
     * ```
     *
     * ---
     *
     * ### üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
     *
     * - –î–µ–ª–∞–µ—Ç –∫–æ–¥ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º –∏ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–º.
     * - –ò—Å–∫–ª—é—á–∞–µ—Ç –æ—à–∏–±–∫–∏ —Ä—É—á–Ω–æ–π —Å–±–æ—Ä–∫–∏ –æ–±—ä–µ–∫—Ç–∞ –æ–ø—Ü–∏–π.
     * - –ü–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.
     * - –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–∑–æ–≤ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∑–∞–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `.with()`.
     * - –ï—Å–ª–∏ –Ω–µ –≤—ã–∑–≤–∞—Ç—å –Ω–∏ `.with()`, –Ω–∏ `.options()`, –æ–ø—Ü–∏–∏ –±—É–¥—É—Ç –Ω–µ –∑–∞–¥–∞–Ω—ã (undefined).
     *
     * ---
     *
     * @param {function(ObserverOptionsBuilder): void} callback ‚Äî —Ñ—É–Ω–∫—Ü–∏—è, –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è –±–∏–ª–¥–µ—Ä –æ–ø—Ü–∏–π –¥–ª—è –ø–æ—à–∞–≥–æ–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
     * @returns {ObserverBuilder} this ‚Äî –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ü–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–æ–≤.
     */
    options(callback) {
        const builder = new ObserverOptionsBuilder();

        callback(builder);

        this.#options = builder.build();

        return this;
    }

    /**
     * üìû –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **callback-—Ñ—É–Ω–∫—Ü–∏—é** –¥–ª—è {@link Observer}, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è
     * –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è (–ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ DOM).
     *
     * –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω: –±–µ–∑ –Ω–µ–≥–æ {@link ObserverBuilder.build()} –≤—ã–±—Ä–æ—Å–∏—Ç –æ—à–∏–±–∫—É.
     *
     * ---
     *
     * ### ‚úÖ –ü—Ä–∏–º–µ—Ä:
     *
     * ```js
     *
     * const observer = new ObserverBuilder()
     *     .for(document.body)
     *     .options((o) => o.descendants().text())
     *     .call((mutations, observer) => {
     *         for (const m of mutations) {
     *             console.log('–ò–∑–º–µ–Ω–µ–Ω–∏–µ:', m);
     *         }
     *     })
     *     .build();
     *
     * observer.observe();
     *
     * ```
     *
     * ---
     *
     * ### üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
     *
     * - Callback –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã {@link Observer}.
     * - –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ ‚Äî –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π callback.
     * - Callback –ø–æ–ª—É—á–∞–µ—Ç –¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞: –º–∞—Å—Å–∏–≤ `MutationRecord[]` –∏ —ç–∫–∑–µ–º–ø–ª—è—Ä `MutationObserver`.
     * - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–µ–ª–æ—á–Ω—ã–µ –∏–ª–∏ –æ–±—ã—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.
     *
     * ---
     *
     * @param {MutationCallback} callback - –§—É–Ω–∫—Ü–∏—è, –≤—ã–∑—ã–≤–∞–µ–º–∞—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ DOM. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –º–∞—Å—Å–∏–≤ `MutationRecord[]` –∏ –æ–±—ä–µ–∫—Ç `MutationObserver`.
     * @returns {ObserverBuilder} this ‚Äî –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ü–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–æ–≤.
     */
    call(callback) {
        this.#callback = callback;

        return this;
    }

    /**
     * üèóÔ∏è –ó–∞–≤–µ—Ä—à–∞–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä {@link Observer}.
     *
     * –ú–µ—Ç–æ–¥ –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≤ –∫–æ–Ω—Ü–µ —Ü–µ–ø–æ—á–∫–∏, –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞ (`.for()`),
     * –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è (`.with()` –∏–ª–∏ `.options()`), –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ (`.call()`).
     *
     * ---
     *
     * ### ‚ö†Ô∏è –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `.build()`:
     *
     * - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –º–µ—Ç–æ–¥ `.call(callback)`, –∏–Ω–∞—á–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞.
     * - –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ü–µ–ª–µ–≤–æ–π —É–∑–µ–ª —á–µ—Ä–µ–∑ `.for()` –∏ –æ–ø—Ü–∏–∏ —á–µ—Ä–µ–∑ `.with()` –∏–ª–∏ `.options()`.
     *
     * ---
     *
     * ### ‚úÖ –ü—Ä–∏–º–µ—Ä:
     *
     * ```js
     *
     * const observer = new ObserverBuilder()
     *     .for(document.getElementById('app'))
     *     .options((o) => o.descendants().text().useOldValue())
     *     .call((mutations) => {
     *         console.log('–ú—É—Ç–∞—Ü–∏–∏:', mutations);
     *     })
     *     .build();
     *
     * observer.observe();
     *
     * ```
     *
     * ---
     *
     * ### üß† –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
     *
     * - –ö–æ–≥–¥–∞ –≤—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é {@link ObserverBuilder} –∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –≥–æ—Ç–æ–≤—ã–π {@link Observer}
     * - –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ fluent-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è
     *
     * ---
     *
     * @throws {Error} –ï—Å–ª–∏ –Ω–µ –±—ã–ª –≤—ã–∑–≤–∞–Ω `.call()`.
     * @returns {Observer} –≠–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ {@link Observer}, –≥–æ—Ç–æ–≤—ã–π –∫ –≤—ã–∑–æ–≤—É `.observe()`.
     */
    build() {
        if (!this.#callback) {
            throw new Error(
                '–ü—Ä–æ–ø—É—â–µ–Ω –≤—ã–∑–æ–≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ ObserverBuilder.call().',
            );
        }

        return new Observer(this.#callback, this.#options, this.#target);
    }
}

export default ObserverBuilder;
